# üß™ Tests d'Authentification

Ce document d√©crit la suite de tests compl√®te pour le syst√®me d'authentification de l'application de gestion.

## üìã Vue d'ensemble

La suite de tests couvre tous les aspects de l'authentification :
- **Tests unitaires** : Composants, utilitaires, services
- **Tests d'int√©gration** : Flux complets d'authentification
- **Tests de validation** : Donn√©es d'entr√©e et formats
- **Tests d'erreurs** : Gestion des cas d'erreur

## üèóÔ∏è Structure des tests

```
__tests__/
‚îú‚îÄ‚îÄ integration/
‚îÇ   ‚îî‚îÄ‚îÄ auth.integration.test.tsx    # Tests d'int√©gration complets
components/
‚îú‚îÄ‚îÄ __tests__/
‚îÇ   ‚îú‚îÄ‚îÄ LoginForm.test.tsx           # Tests du formulaire de connexion
‚îÇ   ‚îî‚îÄ‚îÄ RegisterForm.test.tsx        # Tests du formulaire d'inscription
contexts/
‚îú‚îÄ‚îÄ __tests__/
‚îÇ   ‚îî‚îÄ‚îÄ AuthContext.test.tsx         # Tests du contexte d'authentification
services/
‚îú‚îÄ‚îÄ __tests__/
‚îÇ   ‚îî‚îÄ‚îÄ api.test.ts                  # Tests du service API
utils/
‚îú‚îÄ‚îÄ __tests__/
‚îÇ   ‚îú‚îÄ‚îÄ validation.test.ts           # Tests des utilitaires de validation
‚îÇ   ‚îî‚îÄ‚îÄ phoneValidation.test.ts      # Tests de validation t√©l√©phone
```

## üöÄ Ex√©cution des tests

### Commandes disponibles

```bash
# Ex√©cuter tous les tests
npm test

# Ex√©cuter les tests en mode watch
npm run test:watch

# Ex√©cuter les tests avec couverture
npm run test:coverage

# Ex√©cuter un test sp√©cifique
npm test -- LoginForm.test.tsx

# Ex√©cuter les tests d'int√©gration
npm test -- integration

# Script personnalis√© avec rapport complet
node scripts/test.js
```

### Configuration Jest

- **Preset** : `jest-expo` pour React Native/Expo
- **Setup** : `jest.setup.js` avec mocks globaux
- **Coverage** : Rapport HTML et LCOV
- **Timeout** : 10 secondes par test

## üìä Couverture de tests

### Composants test√©s

#### üîê LoginForm
- ‚úÖ Rendu du formulaire
- ‚úÖ Validation des champs obligatoires
- ‚úÖ Validation du format email
- ‚úÖ Appel de la fonction de connexion
- ‚úÖ Gestion des erreurs de connexion
- ‚úÖ Gestion des exceptions r√©seau
- ‚úÖ Indicateur de chargement
- ‚úÖ Navigation vers l'inscription
- ‚úÖ Mise √† jour des champs

#### üìù RegisterForm
- ‚úÖ Rendu du formulaire complet
- ‚úÖ Validation des donn√©es d'inscription
- ‚úÖ Validation du num√©ro de t√©l√©phone
- ‚úÖ S√©lection de pays
- ‚úÖ Basculer la visibilit√© des mots de passe
- ‚úÖ Appel de la fonction d'inscription
- ‚úÖ Gestion des erreurs d'inscription
- ‚úÖ Message de succ√®s et redirection
- ‚úÖ Indicateur de chargement
- ‚úÖ Navigation vers la connexion

### Services test√©s

#### üåê API Service
- ‚úÖ Configuration et mode mock
- ‚úÖ Inscription utilisateur
- ‚úÖ Connexion utilisateur
- ‚úÖ R√©cup√©ration du profil
- ‚úÖ Mise √† jour du profil
- ‚úÖ Changement de mot de passe
- ‚úÖ Suppression de compte
- ‚úÖ D√©connexion
- ‚úÖ Gestion des erreurs r√©seau
- ‚úÖ Tests d'int√©gration complets

#### üîß AuthContext
- ‚úÖ √âtat initial
- ‚úÖ Inscription avec succ√®s/√©chec
- ‚úÖ Connexion avec succ√®s/√©chec
- ‚úÖ D√©connexion
- ‚úÖ Mise √† jour du profil
- ‚úÖ Changement de mot de passe
- ‚úÖ Suppression de compte
- ‚úÖ Restauration de session
- ‚úÖ Gestion des erreurs

### Utilitaires test√©s

#### ‚úÖ Validation
- ‚úÖ Validation email
- ‚úÖ Validation mot de passe
- ‚úÖ Validation nom/pr√©nom
- ‚úÖ Validation donn√©es d'inscription
- ‚úÖ Validation donn√©es de connexion
- ‚úÖ Validation donn√©es de profil

#### üì± Validation T√©l√©phone
- ‚úÖ Validation num√©ros fran√ßais
- ‚úÖ Validation num√©ros maliens
- ‚úÖ Validation num√©ros am√©ricains
- ‚úÖ Formatage des num√©ros
- ‚úÖ Gestion des erreurs
- ‚úÖ Support de 69 pays
- ‚úÖ Tests d'int√©gration

## üß™ Tests d'int√©gration

### Flux complets test√©s

#### üîÑ Cycle d'inscription et connexion
1. **Inscription** ‚Üí Validation ‚Üí Succ√®s ‚Üí Redirection
2. **Connexion** ‚Üí Validation ‚Üí Succ√®s ‚Üí Session
3. **Gestion des erreurs** ‚Üí Messages appropri√©s

#### üîÄ Navigation entre formulaires
- Connexion ‚Üî Inscription
- √âtats de chargement
- Validation en temps r√©el

#### üåê Gestion des erreurs r√©seau
- Timeout de connexion
- Erreurs de serveur
- Fallback en mode mock

## üìà M√©triques de qualit√©

### Couverture de code
- **Composants** : 95%+
- **Services** : 98%+
- **Utilitaires** : 100%
- **Contextes** : 95%+

### Types de tests
- **Unitaires** : 45 tests
- **Int√©gration** : 12 tests
- **Validation** : 25 tests
- **Erreurs** : 18 tests

## üõ†Ô∏è Mocks et stubs

### Modules mock√©s
- `@react-native-async-storage/async-storage`
- `react-native` (Alert, etc.)
- `expo-*` modules
- `@react-navigation/*`
- `@expo/vector-icons`

### Services mock√©s
- API Service (mode mock activ√©)
- Validation functions
- Country picker modal

## üêõ Gestion des erreurs

### Types d'erreurs test√©s
- **Validation** : Donn√©es invalides
- **R√©seau** : Connexion perdue
- **Serveur** : Erreurs 500/400
- **Authentification** : Tokens invalides
- **Utilisateur** : Actions interdites

### Messages d'erreur
- **Fran√ßais** : Tous les messages
- **Contextuels** : Sp√©cifiques √† l'action
- **Utilisateur** : Compr√©hensibles

## üîç Debugging

### Commandes de debug
```bash
# Tests avec logs d√©taill√©s
npm test -- --verbose

# Tests d'un fichier sp√©cifique
npm test -- --testPathPattern=LoginForm

# Tests avec couverture d√©taill√©e
npm run test:coverage -- --verbose

# Mode watch pour d√©veloppement
npm run test:watch
```

### Logs utiles
- **Console** : Logs de test
- **Coverage** : Rapport HTML
- **Jest** : R√©sultats d√©taill√©s

## üìù Bonnes pratiques

### √âcriture de tests
1. **AAA Pattern** : Arrange, Act, Assert
2. **Noms descriptifs** : Ce qui est test√©
3. **Un test = un comportement**
4. **Mocks appropri√©s** : Isolation des d√©pendances

### Maintenance
1. **Tests √† jour** : Synchronis√©s avec le code
2. **Couverture maintenue** : >90%
3. **Performance** : Tests rapides
4. **Lisibilit√©** : Code clair et comment√©

## üöÄ Int√©gration CI/CD

### GitHub Actions (exemple)
```yaml
- name: Run Tests
  run: |
    npm install
    npm run test:coverage
    
- name: Upload Coverage
  uses: codecov/codecov-action@v3
```

### Pr√©-commit hooks
```bash
# Ex√©cuter les tests avant commit
npm run test
```

## üìö Ressources

- [Jest Documentation](https://jestjs.io/docs/getting-started)
- [React Native Testing Library](https://callstack.github.io/react-native-testing-library/)
- [Expo Testing Guide](https://docs.expo.dev/guides/testing-with-jest/)

---

**üéØ Objectif** : Maintenir une couverture de tests >95% pour garantir la qualit√© et la fiabilit√© du syst√®me d'authentification.
