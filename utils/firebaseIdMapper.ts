// Utilitaire pour g√©rer la correspondance entre IDs locaux et Firebase
import { databaseService } from '../services/DatabaseService';

export const getFirebaseId = async (localId: string): Promise<string | null> => {
  try {
    console.log('üîç [ID MAPPER] Recherche Firebase ID pour:', localId);
    
    const products = await databaseService.getAll('products');
    const product = products.find((p: any) => p.id === localId);
    
    if (product && product.firebase_id) {
      console.log('‚úÖ [ID MAPPER] Firebase ID trouv√©:', product.firebase_id);
      return product.firebase_id;
    }
    
    console.log('‚ö†Ô∏è [ID MAPPER] Aucun Firebase ID trouv√© pour:', localId);
    return null;
  } catch (error) {
    console.error('‚ùå [ID MAPPER] Erreur recherche Firebase ID:', error);
    return null;
  }
};

export const getLocalId = async (firebaseId: string): Promise<string | null> => {
  try {
    console.log('üîç [ID MAPPER] Recherche Local ID pour:', firebaseId);
    
    const products = await databaseService.getAll('products');
    const product = products.find((p: any) => p.firebase_id === firebaseId);
    
    if (product && product.id) {
      console.log('‚úÖ [ID MAPPER] Local ID trouv√©:', product.id);
      return product.id;
    }
    
    console.log('‚ö†Ô∏è [ID MAPPER] Aucun Local ID trouv√© pour:', firebaseId);
    return null;
  } catch (error) {
    console.error('‚ùå [ID MAPPER] Erreur recherche Local ID:', error);
    return null;
  }
};

export const isValidFirebaseId = (id: string): boolean => {
  // Les IDs Firebase sont g√©n√©ralement plus longs et ne commencent pas par "id-"
  return !id.startsWith('id-') && id.length > 10;
};

export const isValidLocalId = (id: string): boolean => {
  // Les IDs locaux commencent par "id-"
  return id.startsWith('id-');
};
